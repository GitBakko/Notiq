@tailwind base;
@tailwind components;
@tailwind utilities;

/* ── Geist Font Family ── */
@font-face {
  font-family: 'Geist Sans';
  src: url('/fonts/GeistSans-Variable.woff2') format('woff2');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: 'Geist Mono';
  src: url('/fonts/GeistMono-Variable.woff2') format('woff2');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

/* ── Design Tokens ── */
:root {
  /* Slate neutrals (blue-gray) */
  --color-bg-primary: #f8fafc;
  --color-bg-secondary: #f1f5f9;
  --color-bg-sidebar: #141822;
  --color-bg-sidebar-hover: #1e293b;

  --color-text-primary: #0c0f14;
  --color-text-secondary: #64748b;
  --color-text-sidebar: #cbd5e1;

  --color-accent: #10b981;
  --color-accent-hover: #059669;
  --color-accent-warm: #f59e0b;
  --color-accent-warm-hover: #d97706;
  --color-danger: #ef4444;

  --color-border: #e2e8f0;

  /* Typography */
  --font-sans: 'Geist Sans', system-ui, -apple-system, sans-serif;
  --font-mono: 'Geist Mono', ui-monospace, 'Cascadia Code', monospace;

  /* Spacing */
  --spacing-xs: 0.25rem;
  --spacing-sm: 0.5rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.04);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.07), 0 2px 4px -2px rgb(0 0 0 / 0.05);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.04);
  --shadow-card-hover: 0 8px 25px -5px rgb(0 0 0 / 0.1), 0 4px 10px -6px rgb(0 0 0 / 0.04);

  /* Transitions */
  --transition-fast: 150ms ease-out;
  --transition-normal: 200ms ease-out;
  --transition-slow: 300ms ease-out;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-sans);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  height: 100vh;
  overflow: hidden;
}

.dark body {
  background-color: #0c0f14;
  color: #e2e8f0;
}

#root {
  height: 100%;
}

/* ── Scrollbar ── */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}

.dark ::-webkit-scrollbar-thumb {
  background: #334155;
}

.dark ::-webkit-scrollbar-thumb:hover {
  background: #475569;
}

/* Hide scrollbar but keep scroll functionality */
.scrollbar-none {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.scrollbar-none::-webkit-scrollbar {
  display: none;
}

/* ── Design System Utilities ── */

/* Staggered fade-in for list items */
.animate-stagger-in > * {
  opacity: 0;
  animation: stagger-fade-in 0.3s ease-out forwards;
}
.animate-stagger-in > *:nth-child(1) { animation-delay: 0ms; }
.animate-stagger-in > *:nth-child(2) { animation-delay: 40ms; }
.animate-stagger-in > *:nth-child(3) { animation-delay: 80ms; }
.animate-stagger-in > *:nth-child(4) { animation-delay: 120ms; }
.animate-stagger-in > *:nth-child(5) { animation-delay: 160ms; }
.animate-stagger-in > *:nth-child(n+6) { animation-delay: 200ms; }

@keyframes stagger-fade-in {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Card hover lift */
.hover-lift {
  transition: transform var(--transition-normal), box-shadow var(--transition-normal);
}
.hover-lift:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-card-hover);
}

/* Shake animation for form errors */
.animate-shake {
  animation: shake 0.5s ease-in-out;
}
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-4px); }
  40%, 80% { transform: translateX(4px); }
}

/* Sync dot animation */
.sync-dot {
  animation: pulse-dot 1.5s ease-in-out infinite;
}
@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* ── Collaboration Styles ── */
.collaboration-cursor__caret {
  border-left: 1px solid #0d0d0d;
  border-right: 1px solid #0d0d0d;
  margin-left: -1px;
  margin-right: -1px;
  pointer-events: none;
  position: relative;
  word-break: normal;
}

.collaboration-cursor__label {
  border-radius: 3px 3px 3px 0;
  color: #0d0d0d;
  font-size: 12px;
  font-style: normal;
  font-weight: 600;
  left: -1px;
  line-height: normal;
  padding: 0.1rem 0.3rem;
  position: absolute;
  top: -1.4em;
  user-select: none;
  white-space: nowrap;
  z-index: 10;
}

/* Remote Changes Highlights */
@keyframes fadeOut {
  from {
    background-color: rgba(16, 185, 129, 0.3);
  }
  to {
    background-color: transparent;
  }
}

@keyframes deleteFadeOut {
  from {
    opacity: 1;
    text-decoration: line-through;
    color: #ef4444;
    background-color: rgba(239, 68, 68, 0.1);
  }
  to {
    opacity: 0;
    text-decoration: line-through;
    color: #ef4444;
    background-color: transparent;
  }
}

.remote-change-add {
  animation: fadeOut 3s ease-out forwards;
}

.remote-change-delete {
  display: inline-block;
  pointer-events: none;
  animation: deleteFadeOut 3s ease-out forwards;
}

/* Dark mode adjustments */
.dark .collaboration-cursor__label {
  color: #fff;
}

/* ── ProseMirror Editor ── */
.ProseMirror {
  max-width: none !important;
  overflow-wrap: break-word;
  word-break: break-word;
}

/* Table Styles */
.ProseMirror table {
  border-collapse: collapse;
  table-layout: fixed;
  margin: 0;
  border: 1px solid #d1d5db;
}

.ProseMirror td,
.ProseMirror th {
  min-width: 1em;
  border: 1px solid #d1d5db;
  padding: 4px 8px;
  vertical-align: top;
  box-sizing: border-box;
  position: relative;
  white-space: normal;
  word-break: break-word;
  line-height: 1.2;
  font-size: 14px;
}

.ProseMirror th {
  font-weight: bold;
  text-align: left;
  background-color: #f1f3f5;
}

.dark .ProseMirror table {
  border-color: #4b5563;
}

.dark .ProseMirror th {
  background-color: #374151;
  border-color: #4b5563;
}

.dark .ProseMirror td {
  border-color: #4b5563;
}

/* Prevent Tailwind Typography from scaling table cells */
:is(.prose, .prose-sm, .prose-lg, .prose-xl, .prose-2xl) :is(td, th) {
  font-size: 14px !important;
  line-height: 1.2 !important;
  padding: 4px 8px !important;
}

/* Force line-height on ALL elements inside table cells (prose overrides p, a, li, etc.) */
.ProseMirror td *,
.ProseMirror th * {
  line-height: 1.2 !important;
}

.ProseMirror .selectedCell:after {
  z-index: 2;
  position: absolute;
  content: "";
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  background: rgba(200, 200, 255, 0.4);
  pointer-events: none;
}

.ProseMirror .column-resize-handle {
  position: absolute;
  right: -2px;
  top: 0;
  bottom: -2px;
  width: 4px;
  background-color: #adf;
  pointer-events: auto;
  cursor: col-resize;
  z-index: 20;
}

.ProseMirror.resize-cursor {
  cursor: col-resize;
}

/* Row Resize */
.ProseMirror .row-resize-active {
  border-bottom: 2px solid #adf;
}

.ProseMirror.resize-row-cursor {
  cursor: row-resize;
}

/* Table Selection Highlight */
.ProseMirror-selectednode {
  outline: 2px solid var(--color-accent);
}

/* Inline Images */
.ProseMirror img {
  max-width: 100%;
  height: auto;
  border-radius: 0.5rem;
  cursor: default;
}

/* Resizable image node view */
.ProseMirror .image-resizable {
  display: inline-block;
  margin: 0.5rem 0;
  line-height: 0;
}

.ProseMirror .image-resizable img {
  margin: 0;
}

/* Scroll to Edit Button Animation */
@keyframes bounceSubtle {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}
.animate-bounce-subtle {
  animation: bounceSubtle 2s ease-in-out infinite;
}

/* ── Safe Area Utilities (PWA) ── */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}
.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}
.safe-area-left {
  padding-left: env(safe-area-inset-left);
}
.safe-area-right {
  padding-right: env(safe-area-inset-right);
}
